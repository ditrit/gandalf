---

image: 'golang:latest'

before_script:
    - 'go version'

    # Setup project environment
    - '# DELETE SYMLINK IF EXIST'
    - '! test -f ${GOPATH}/src/gandalf-go || rm -f ${GOPATH}/src/gandalf-go'
    - '# SETUP SYMLINK TO MAKE GO WORK PROPERLY'
    - 'ln -s ${PWD} ${GOPATH}/src/gandalf-go'

    # Install zeromq and libdqlite (needed by 0mq)
    - 'apt-get update -y'
    - 'apt-get upgrade -y '

    - 'apt-get install -y software-properties-common'
    - 'add-apt-repository ppa:dqlite/stable'
    - 'apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 06CD096F50FB3D04'

    - 'apt-get update -y'
    - 'apt-get install -y
                libdqlite-dev
                libzmq3-dev'

    # Get all depedencies
    - 'go get -d -v ./...'

stages:
    - std
    - lint

build:
    stage: std
    script:
        - 'go build'

gofmt:
    stage: std
    script:
        - 'gofmt -l .'

golangci-lint:
    stage: lint
    script:
        - 'curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.23.3'
        - 'golangci-lint --version'
        - 'golangci-lint run -v ./...'

...
